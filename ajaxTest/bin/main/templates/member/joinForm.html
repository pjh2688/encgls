<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>joinForm.html</title>
	
</head>
<body>
	<a href="/">메인페이지</a>
	 <!--  주의  : input 값에 name 속성에 값이 있어야 전송할떄 전송된다. --> 
	<div class="container">
		<a>--------------------</a>
		<h1>회원가입</h1>
		<a>--------------------</a>
		<form id="joinForm" name="joinForm" method="post">
			<!-- // form-area -->
			<div class="form-area">
			
				<!-- // agree-letter-box -->
				<h2>서비스 이용약관 및 개인정보 처리방침 동의</h2><br/><br/>
				<div class="agree-letter-box">
					<!-- // agree-letter -->
					<div class="agree-letter">
						<div class="title">개인 정보 수집 및 이용 수칙</div>
						<div class="letter" tabindex="0">
							본 가입페이지를 통해 제출하는 개인정보는 (주)이앤씨지엘에스(이하 서비스 제공 회사)가 직접 관리하며, 
							서비스를 이용하기 위해서는 아래 개인 정보 제공등에 관해 반드시 동의하셔야 합니다.
						</div>
					</div>		
					<!-- agree-letter // -->
					
					<!-- // agree-check -->
					<div class="agree-check" style="margin-bottom: 45px;">
						<input type="checkbox" name="s_chk" id="s_chk" placeholder="개인, 민감 정보 수집 및 이용에 동의해 주세요">
						<label for="s_chk">개인 정보 수집 및 이용 수칙에 동의합니다.</label>
					</div>
					<!-- agree-check // -->
					
					<!-- // agree-letter last -->
					<div class="agree-letter last">
						<div class="title">개인, 민감 정보 수집 및 이용 동의</div>
						<div class="letter" tabindex="0">
							1. 수집하는 개인정보 항목<br>
							회원가입에 표기되는 모든 항목<br>
							2. 수집 및 이용 목적<br>
							서류 심사, 상담 등의 근거자료로 활용하며 전문 서비스 제공 및 안내와 같은 알림을 위해 사용합니다. <br>
							3. 개인정보의 보유 및 이용 기간 <br>
							지원서상에 작성하신 개인정보는 서비스의 제공을 위해 활용될 예정으로 등록일로부터 3년까지 보관됩니다.
						</div>
					</div>
					<!-- agree-letter last // -->
					
					<!-- // agree-check -->
					<div class="agree-check">
						<input type="checkbox" name="p_chk" id="p_chk" placeholder="개인, 민감 정보 수집 및 이용에 동의해 주세요">
						<label for="p_chk">개인, 민감 정보 수집 및 이용에 동의합니다.</label>
					</div>
					<!-- agree-check // -->
					
				</div>
				<!-- agree-letter-box // -->
				
				<!-- // register-form -->
				<div class="register-form">
					<a>------------------------</a>
					<h2>개인 정보 입력</h2>
					<a>------------------------</a>
					<!-- // table 1 -->
					<table>
						<colgroup>
							<col style="width: 18.75%">
							<col style="width: 81.25%">
						</colgroup>
						
						<tbody>
							<!-- 아이디 -->
							<tr>
								<th scope="row">
									<label for="userid">아이디<span style="color: red;">*</span></label>
								</th>
								<td>
									<!-- autocomplete="off" -> submit 시 자동완성 내역 뜨는거 방지 -->
									<input type="text" class="input" id="userid" name="userid" style="width:50%;" placeholder="아이디" min="5" onblur="reset_idChkValue();">
									<a href="javascript:id_check();" class="btn-pack custom" style="height: 34px; margin-left: 10px;">중복체크</a>
								</td>
							</tr>
							
							<!-- KT 클라우드 ID -->
							<tr>
								<th scope="row">
									<label for="ktcloudid">KT 클라우드 ID<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="ktcloudid" name="ktcloudid" style="width:50%;" placeholder="KT 클라우드 ID" min="5" onblur="reset_ktidChkValue();">
									<a href="javascript:ktcloudid_check();" class="btn-pack custom" style="height: 34px; margin-left: 10px;">중복체크</a>
								</td>
							</tr>
							
							<!-- 비밀번호 -->
							<tr>
								<th scope="row">
									<label for="password">비밀번호<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="password" class="input" id="password" name="password" style="width:50%;" placeholder="비밀번호" min="5">
								</td>
							</tr>
							
							<!-- 비밀번호 확인 -->
							<tr>
								<th scope="row">
									<label for="password_re">비밀번호 확인<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="password" class="input" id="password_re" name="password_re" style="width:50%;" placeholder="비밀번호 확인" min="5">
								</td>
							</tr>
							
							<!-- 담당자 이름 -->
							<tr>
								<th scope="row">
									<label for="usernm">사용자 이름<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="usernm" name="usernm" style="width:50%;" placeholder="담당자 이름">
								</td>
							</tr>
							
							<!-- 휴대전화번호 -->
							<tr>
								<th scope="row">
									<label for="hphone">휴대전화번호<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="hphone" name="hphone" style="width:50%;" placeholder="휴대전화 번호">
								</td>
							</tr>		
							
							<!-- 이메일 -->
							<tr>
								<th scope="row">
									<label for="email">이메일<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="email" name="email" style="width:50%;" placeholder="이메일">
								</td>
							</tr>	
							
							<!-- 캡차 -->
							<tr>
								<th scope="row">
									<label for="captcha">자동 입력 방지<span style="color: red;">*</span></label>
								</th>
								<td>
									<div>
										<img title="캡차이미지" src="/member/captchaImg" alt="캡차이미지"/>
										<div id="ccaudio" style="display:none"></div>
									</div>
									<div>
										<input id="reload" type="button" onclick="javaScript:getImage()" value="새로 고침"/> 
										<input id="soundOn" type="button" onclick="javaScript:audio()" value="음성 듣기"/>
									</div>
									<div style="padding-top: 5px;">
										<input id="answer" type="text" value="" size="10"> 
										<input id="check" type="button" value="확인"/>
									</div>
								</td>
							</tr>									
						</tbody>
					</table>
					<!-- table 1 // -->
					<a>----------------------------</a>
					<h2>사업장 정보 입력</h2>
					<a>----------------------------</a>
					<table>
						<colgroup>
							<col style="width: 18.75%">
							<col style="width: 81.25%">
						</colgroup>
						
						<tbody>
							<!-- 사업자 상호 -->
							<tr>
								<th scope="row">
									<label for="comp_name">사업자 상호<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="comp_name" name="comp_name" style="width:50%;" placeholder="사업자 상호">
								</td>
							</tr>
							
							<!-- 사업자 CEO 이름 -->
							<tr>
								<th scope="row">
									<label for="ceonm">사업자 이름<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="ceonm" name="ceonm" style="width:50%;" placeholder="사업자 이름">
								</td>
							</tr>
							
							<!-- 사업자 등록 번호 -->
							<tr>
								<th scope="row">
									<label for="biznum">사업자 등록번호<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="biznum" name="biznum" style="width:50%;" placeholder="사업자 등록번호">
								</td>
							</tr>
							
							<!-- 사업장 주소-->
							<tr>
								<th scope="row">
									<label for="comp_addr">사업장 주소<span style="color: red;">*</span></label>
								</th>
								<td>
									<input type="text" class="input" id="comp_addr" name="comp_addr" style="width:50%;" placeholder="사업장 주소">
								</td>
							</tr>
			
													
						</tbody>
					</table>
					<!-- table 1 // -->
					
				</div>
				<!-- register-form // -->
				
				<!-- // testForm submit -->
				<div>
					<input type="submit" id="send" name="send" value="send">
				</div>
				<!-- testForm submit // -->
				
			</div>
			<!-- form-area // -->
		</form>
	</div>
	
	
</body>
<script src="/assets/js/jquery-3.5.1.min.js"></script> <!-- 1. static 파일은 모두 절대경로 / 를 사용  -->
<script src="/assets/js/jquery-serialize-object.js"></script> <!-- 7. 폼 객체를 json 객체로 변환해서 보낼려면 추가. -->
<script type="text/javascript">
// id, ktid 중복체크 값.
var id_checkvalue = 0;
var ktid_checkvalue = 0;

// chk id, chk ktid
var checked_id;
var checked_ktid;

// 정규식 패턴
var pattern1 = /[0-9]/; // 숫자 
var pattern2 = /[a-zA-Z]/; // 문자(알파벳 대문자,소문자)
var pattern3 = /[~!@#$%^&*()_+|<>?:{}]/;  // 특수문자
var pattern4 = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;  // 한글
var pattern5 = /[\s]/g;  // 공백
var pattern6 = /[A-Z]/;  // 영어 대문자
var pattern7 = /[a-z]/;  // 영어 소문자

// email 정규식
var valid_email = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;

//ㅠ자동 입력 방지 확인 값. 초기값 0


// submit시 체크박스 체크 여부
$(document).ready(function() {
	$("#joinForm").on("submit", function(e) {
		e.preventDefault();  // 3-1. submit 동작을 막는다.
		if( !$("input:checkbox[id='s_chk']").is(":checked") ) { // 3-2. s_chk 체크박스에 체크가 안되있다면
			alert("개인 정보 수집 및 이용 수칙에 동의하셔야 합니다.");
			$('#s_chk').focus();
			return;
		} else if ( !$("input:checkbox[id='p_chk']").is(":checked") ) {  // 3-3. p_chk 체크박스에 체크가 안되있다면
			alert("개인, 민감 정보 수집 및 이용에 동의하셔야 합니다.");
			$('#p_chk').focus();
			return;
		} else {
			
			if($('input#userid').val() == "" || $('input#userid').val() == null) {
				alert("아이디를 입력해주세요.");
				$('#userid').focus();
				return;
			} else if(id_checkvalue == 0) {
				alert("아이디 중복확인을 하세요.")
				$('#userid').focus();
				return;
			} else if($('input#ktcloudid').val() == "" || $('input#ktcloudid').val() == null) {
				alert("KT CLOUD ID를 입력해주세요.");
				$('#ktcloudid').focus();
				return;
			} else if(ktid_checkvalue == 0) {
				alert("kt cloud id 중복확인을 하세요.")
				$('#ktcloudid').focus();
				return;
			} else if($('input#password').val() == "" || $('input#password').val() == null) {
				alert("패스워드를 입력해주세요.");
				$('#password').focus();
				return;
			} else if(
					$('input#password').val().length < 8 ||  // 8자리 이상
					$('input#password').val().length > 16 ||  // 15자리 미만 
					!pattern1.test( $('input#password').val() ) ||  // 숫자
					!pattern2.test( $('input#password').val() ) ||   // 영문대소문자
					!pattern3.test( $('input#password').val() ) ) {  // 특수문자
				
				alert("숫자와 영문자,특수문자를 모두 사용한 8~15자리의 비밀번호여야 합니다.");
				$('#password').focus();
				return;
			} else if($('input#password_re').val() == "" || $('input#password_re').val() == null) {
				alert("패스워드 확인을 입력해주세요.");
				$('#password_re').focus();
				return;
			} else if($('input#password').val() != $('input#password_re').val()) {
				alert("패스워드가 동일하지 않습니다.");
				$('#password').focus();
				return;
			} else if($('input#usernm').val() == "" || $('input#usernm').val() == null ) {  // search(/\s/) != -1
				alert("사용자 이름을 입력해주세요.");
				$('#usernm').focus();
				return;
			} else if($('input#usernm').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#usernm').val('');
				$('#usernm').focus();
				return;
			}
			else if($('input#hphone').val() == "" || $('input#hphone').val() == null) {
				alert("휴대폰 번호를 입력해주세요.");
				$('#hphone').focus();
				return;
			} else if($('input#hphone').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#hphone').val('');
				$('#hphone').focus();
				return;
			} else if($('input#email').val() == "" || $('input#email').val() == null) {
				alert("이메일 주소를 입력해주세요.");
				$('#email').focus();
				return;
			} else if($('input#email').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#email').val('');
				$('#email').focus();
				return;
			} else if(valid_email.test($('input#email').val()) == false) { // test() : 검색한 문자열에 패턴이 있는지 여부를 나타낸다, 문자열이 존재하면 true, 존재하지 않으면 false를 리턴한다.
				alert("이메일 형식이 올바르지 않습니다.");
				$('#email').focus();
				return;
			} else if($('input#comp_name').val() == "" || $('input#comp_name').val() == null) {
				alert("사업자 상호를 입력해주세요.");
				$('#comp_name').focus();
				return;
			} else if($('input#comp_name').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#comp_name').val('');
				$('#comp_name').focus();
				return;
			} else if($('input#ceonm').val() == "" || $('input#ceonm').val() == null) {
				alert("사업자 이름을 입력해주세요.");
				$('#ceonm').focus();
				return;
			} else if($('input#ceonm').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#ceonm').val('');
				$('#ceonm').focus();
				return;
			} else if($('input#biznum').val() == "" || $('input#biznum').val() == null) {
				alert("사업자 등록번호를 입력해주세요.");
				$('#biznum').focus();
				return;
			} else if($('input#biznum').val().search(/\s/) != -1)  {
				alert("공백이 있습니다.");
				$('#biznum').val('');
				$('#biznum').focus();
				return;
			} else if($('input#comp_addr').val() == "" || $('input#comp_addr').val() == null) {
				alert("사업장 주소를 입력해주세요.");
				$('#comp_addr').focus();
				return;
			} else if($('input#comp_addr').val() != $('input#comp_addr').val().trim()) {  // 입력 값과 trim()함수로 앞 뒤 공백을 자른 값이 다르면 앞이나 뒤에 공백이 있다는 말.
				alert("공백이 있습니다.");
				$('#comp_addr').val('');
				$('#comp_addr').focus();
				return;
			} else {
				var formData = $('#joinForm').serializeObject();  // 컨트롤러에서 object로 받으니 ajax에서도 object 형태의 데이터를 만들어서 JSON.stringify로 json string형태로 바꿔 전송해줘야한다. 
//				alert(JSON.stringify(formData));
				
				$.ajax({
					data : JSON.stringify(formData),
					url : "/member/join",
					type : "post",
					dataType : "json",
					contentType : "application/json; charset=UTF-8",
					success : function(data) {
						/*
							1. JSON.parse : json 포맷 데이터를 json 객체로 변환.
							2. JSON.stringify : json 객체를 json 포맷 데이터로 변환.
						*/
//						alert(data.message);
						location.href = "/";  // url mapping은 상대경로("~"), href나 return은 절대경로("/~")
						
					},
					error: function() {
						alert("error");
					}
				});
			}
		}
	
	});
});

// id 중복체크
function id_check() {
	var input_id = $('input#userid').val();
	
	if(input_id == "" || input_id == null) {
		alert("아이디를 입력해주세요.");
		$('#userid').focus();
		return;
	} else if(pattern3.test(input_id)) {
		alert("특수문자가 포함되어 있습니다.");
		$('#userid').val('');
		$('#userid').focus();
		return;
		
	} else if(pattern4.test(input_id)) {
		alert("한글이 포함되어 있습니다.");
		$('#userid').val('');
		$('#userid').focus();
		return;
	} else if(pattern5.test(input_id)) {  
		alert("공백이 있습니다.");
		$('#userid').val('');
		$('#userid').focus();
		return;
	} else if(pattern6.test(input_id)) {  
		alert("영어 대문자가 포함되어 있습니다. 소문자로 입력해주세요.");
		$('#userid').val('');
		$('#userid').focus();
		return;
	} 
	
	$.ajax({
		data : input_id,  // 서버로 보낼 데이터
		url : "/member/id_check",  // 서버쪽 컨트롤러에 매핑될 url
		type : "post",  // 데이터를 전송하는 방법을 지정한다. get, post를 사용할 수 있다.
		dataType : "json",  // 서버 쪽에서 전송한 데이터를 어떤 형식의 데이터로 해석할 것인가를 지정한다. 값으로 올 수 있는 것은 xml, json, script, html이다.
		contentType : "application/json; charset=UTF-8",
		success : function(data) {
			/*
				1. JSON.parse : json 포맷 데이터를 json 객체로 변환.
				2. JSON.stringify : json 객체를 json 포맷 데이터로 변환.
			*/
			if(data.check > 0) {
				alert("이미 사용 중인 아이디입니다.");
				$('#userid').val('');
				$('#userid').focus();
				
				return;
			} else if(data.check == 0) {
				alert("사용 가능한 아이디입니다.");
				$('#userid').focus();
				
				id_checkvalue = 1;
				
				checked_id = $('input#userid').val();
				
				return;
			} 
			
		},
		error: function() {
			alert("error");
		}
	});
}

// ktcloudid 중복체크
function ktcloudid_check() {
	
	var input_id = $('input#ktcloudid').val();
	
	if(input_id == "" || input_id == null) {
		alert("KT CLOUD ID를 입력해주세요.");
		$('#ktcloudid').focus();
		return;
	} else if(pattern3.test(input_id)) {
		alert("특수문자가 포함되어 있습니다.");
		$('#ktcloudid').val('');
		$('#ktcloudid').focus();
		return;
		
	} else if(pattern4.test(input_id)) {
		alert("한글이 포함되어 있습니다.");
		$('#ktcloudid').val('');
		$('#ktcloudid').focus();
		return;
	}
	
	$.ajax({
		data : input_id,
		url : "/member/ktcloudid_check",
		type : "post",
		dataType : "json",
		contentType : "application/json; charset=UTF-8",
		success : function(data) {
			/*
				1. JSON.parse : json 포맷 데이터를 json 객체로 변환.
				2. JSON.stringify : json 객체를 json 포맷 데이터로 변환.
			*/
			if(data.check > 0) {
				alert("이미 사용 중인 아이디입니다.");
				$('#ktcloudid').val('');
				$('#ktcloudid').focus();
				
				return;
			} else if(data.value.search(/\s/) != -1) {  // 공백이 있는 위치 값을 반환, 공백이 없으면 -1을 반환
				alert("공백이 있습니다.");
				$('#ktcloudid').val('');
				$('#ktcloudid').focus();
				return;
			} else if(data.check == 0) {
				alert("사용 가능한 아이디입니다.");
				$('#ktcloudid').focus();
				
				ktid_checkvalue = 1;
				
				checked_ktid = $('input#ktcloudid').val();
				
				return;
			} 
			
		},
		error: function() {
			alert("error");
		}
	});
}

// id 체크값 초기화 or 유지(onblur)
function reset_idChkValue() {
	if(checked_id == $('input#userid').val()) {
		id_checkvalue = 1;
	} else {
		id_checkvalue = 0;
	}
		
}

// ktid 체크값 초기화 or 유지(onblur)
function reset_ktidChkValue() {
	if(checked_ktid == $('input#ktcloudid').val()) {
		ktid_checkvalue = 1;
	} else {
		ktid_checkvalue = 0;
	}
		
}

// captcha 이미지 새로고침 기능(숫자 랜덤)
function getImage(){ 
	var rand = Math.random(); 
	var url = '/member/captchaImg?rand='+rand; 
	document.querySelector('img').setAttribute('src', url); 
}

// captcha 오디오 새로고침 기능
function audio(){
	var rand = Math.random(); 
	var uAgent = navigator.userAgent; 
	var soundUrl = '/member/captchaAudio?rand='+rand; 
	
	if(uAgent.indexOf('Trident') > -1 || uAgent.indexOf('MISE')> -1) { /*IE 경우 */ 
		audioPlayer(soundUrl); 
	} else if(!!document.createElement('audio').canPlayType) { /*Chrome 경우 */ 
		try { 
			new Audio(soundUrl).play(); 
		} catch (e) { 
			audioPlayer(soundUrl); 
		} 
	}else {
		window.open(soundUrl,'','width=1,height=1'); 
	} 
}

function audioPlayer(objUrl) { 
	document.querySelector('#ccaudio').innerHTML = '<bgsoun src="' +objUrl +'">'; 
}

// 자동 입력 방지 확인 버튼 누르면 실행.
$("#check").click(function(){
	var param = $('input#answer').val();
	
	alert(param);
	$.ajax({
		data : param,
		url : "/member/chkAnswer",
		type : "post",
		dataType : "json",
		contentType : "application/json; charset=UTF-8",
		success : function(data) {
			/*
				1. JSON.parse : json 포맷 데이터를 json 객체로 변환.
				2. JSON.stringify : json 객체를 json 포맷 데이터로 변환.
			*/
			alert(data.check);
			if(data.check == '200') {
				alert("자동 입력 방지 문자와 일치합니다.");
				
				
			} else if(data.check == '300') {
				alert("자동 입력 방지 문자가 일치하지 않습니다");
				getImage();
				$('input#answer').val("");
				return;
			}
		},
		error: function() {
			alert("error");
			
		}
	});
});


</script>
</html>